{% extends 'base.html' %}
{% load static %}

{% block title %}Telegram orqali kirish - Avtokontinent.uz{% endblock %}

{% block description %}
Avtokontinent.uz saytiga Telegram bot orqali oson va xavfsiz kirish.
Faqat 30 soniyada ro'yxatdan o'ting va xaridlarni boshlang.
{% endblock %}

{% block keywords %}
telegram login, kirish, ro'yxatdan o'tish, avtokontinent, telegram bot,
xavfsiz kirish, avtomobil ehtiyot qismlar
{% endblock %}

{% block extra_css %}
<style>
    .telegram-gradient {
        background: linear-gradient(135deg, #0088cc 0%, #229ed9 100%);
    }

    .step-card {
        transition: all 0.3s ease;
    }

    .step-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }

    .step-number {
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    }

    .code-input {
        font-family: 'Courier New', monospace;
        font-size: 1.5rem;
        font-weight: bold;
        letter-spacing: 0.2em;
        text-align: center;
    }

    .pulse-animation {
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }

    .floating-animation {
        animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50">
    <div class="container mx-auto px-4 py-8">

        <!-- Page Header -->
        <div class="text-center mb-12">
            <div class="inline-flex items-center space-x-3 mb-6">
                <div class="telegram-gradient p-3 rounded-xl">
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                    </svg>
                </div>
                <div>
                    <h1 class="text-3xl lg:text-4xl font-bold text-gray-900">Telegram orqali kirish</h1>
                    <p class="text-gray-600 mt-2">Xavfsiz va oson ro'yxatdan o'tish</p>
                </div>
            </div>
        </div>

        <div class="max-w-4xl mx-auto">
            <div class="grid lg:grid-cols-2 gap-12 items-start">

                <!-- Left Column - Instructions -->
                <div class="space-y-8">

                    <!-- How it works -->
                    <div class="bg-white rounded-2xl p-8 shadow-lg">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center space-x-2">
                            <svg class="w-6 h-6 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span>Qanday ishlaydi?</span>
                        </h2>

                        <div class="space-y-6">
                            <!-- Step 1 -->
                            <div class="step-card bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6">
                                <div class="flex items-start space-x-4">
                                    <div class="step-number w-10 h-10 rounded-full text-white flex items-center justify-center font-bold text-lg flex-shrink-0">
                                        1
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-900 mb-2">Telegram botni oching</h3>
                                        <p class="text-gray-600 text-sm mb-3">
                                            Quyidagi tugmani bosib, bizning rasmiy Telegram botimizni oching
                                        </p>
                                        <a href="https://t.me/{{ bot_username }}"
                                           target="_blank"
                                           class="inline-flex items-center bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium">
                                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                                            </svg>
                                            @{{ bot_username }} botni ochish
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 2 -->
                            <div class="step-card bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6">
                                <div class="flex items-start space-x-4">
                                    <div class="step-number w-10 h-10 rounded-full text-white flex items-center justify-center font-bold text-lg flex-shrink-0">
                                        2
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-900 mb-2">/start buyrug'ini bosing</h3>
                                        <p class="text-gray-600 text-sm mb-3">
                                            Bot ochilgach, <code class="bg-gray-100 px-2 py-1 rounded text-xs">/start</code> tugmasini bosing
                                        </p>
                                        <div class="bg-green-100 p-3 rounded-lg">
                                            <p class="text-green-800 text-sm">
                                                üí° <strong>Maslahat:</strong> Agar /start ko'rinmasa, chatga "/start" deb yozing
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 3 -->
                            <div class="step-card bg-gradient-to-r from-orange-50 to-yellow-50 rounded-xl p-6">
                                <div class="flex items-start space-x-4">
                                    <div class="step-number w-10 h-10 rounded-full text-white flex items-center justify-center font-bold text-lg flex-shrink-0">
                                        3
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-900 mb-2">Kontaktingizni yuboring</h3>
                                        <p class="text-gray-600 text-sm mb-3">
                                            Bot sizdan kontakt so'raydi. "üìû Kontaktni yuborish" tugmasini bosing
                                        </p>
                                        <div class="bg-orange-100 p-3 rounded-lg">
                                            <p class="text-orange-800 text-sm">
                                                üîí <strong>Xavfsizlik:</strong> Sizning telefon raqamingiz faqat ro'yxatdan o'tish uchun ishlatiladi
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 4 -->
                            <div class="step-card bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6">
                                <div class="flex items-start space-x-4">
                                    <div class="step-number w-10 h-10 rounded-full text-white flex items-center justify-center font-bold text-lg flex-shrink-0">
                                        4
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-900 mb-2">5 xonali kodni oling</h3>
                                        <p class="text-gray-600 text-sm mb-3">
                                            Bot sizga 5 xonali kod beradi. Bu kodni quyidagi maydonga kiriting
                                        </p>
                                        <div class="bg-purple-100 p-3 rounded-lg">
                                            <p class="text-purple-800 text-sm">
                                                ‚è∞ <strong>Muhim:</strong> Kod 2 daqiqa davomida amal qiladi
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Why Telegram? -->
                    <div class="bg-white rounded-2xl p-8 shadow-lg">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">Nega Telegram orqali?</h3>
                        <div class="space-y-3 text-sm text-gray-600">
                            <div class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span>Parol eslab qolish shart emas</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span>30 soniyada ro'yxatdan o'tish</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span>Buyurtma haqida xabarlar Telegram'da</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span>Maxfiy ma'lumotlar himoyalangan</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column - Login Form -->
                <div class="lg:sticky lg:top-8">
                    <div class="bg-white rounded-2xl p-8 shadow-xl border border-gray-100">

                        <!-- Current Step Indicator -->
                        <div class="mb-8" x-data="{ currentStep: 'instructions' }">
                            <div class="flex items-center justify-center space-x-2 mb-6">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-primary-600 rounded-full"></div>
                                    <span class="text-sm font-medium text-primary-600">1. Botga o'ting</span>
                                </div>
                                <div class="w-8 h-px bg-gray-300"></div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-gray-300 rounded-full"></div>
                                    <span class="text-sm text-gray-500">2. Kodni kiriting</span>
                                </div>
                            </div>
                        </div>

                        <!-- Bot Link (Big Button) -->
                        <div class="text-center mb-8">
                            <a href="https://t.me/{{ bot_username }}"
                               target="_blank"
                               class="inline-flex items-center telegram-gradient text-white px-8 py-4 rounded-xl hover:shadow-lg transition-all duration-300 font-semibold text-lg group">
                                <svg class="w-6 h-6 mr-3 group-hover:scale-110 transition-transform" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                                </svg>
                                <span>Botni ochish</span>
                                <svg class="w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                </svg>
                            </a>
                            <p class="text-sm text-gray-500 mt-3">
                                Yangi oynada @{{ bot_username }} ochiladi
                            </p>
                        </div>

                        <!-- Divider -->
                        <div class="relative mb-8">
                            <div class="absolute inset-0 flex items-center">
                                <div class="w-full border-t border-gray-200"></div>
                            </div>
                            <div class="relative flex justify-center text-sm">
                                <span class="px-4 bg-white text-gray-500">Keyin</span>
                            </div>
                        </div>

                        <!-- Code Input Form -->
                        <div x-data="{
                            code: '',
                            isSubmitting: false,
                            errorMessage: '',

                            async submitCode() {
                                if (this.code.length !== 5) {
                                    this.errorMessage = '5 xonali kodni to\'liq kiriting';
                                    return;
                                }

                                this.isSubmitting = true;
                                this.errorMessage = '';

                                try {
                                    console.log('Sending code:', this.code);

                                    const response = await fetch('/auth/verify-code/', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json'
                                            // CSRF token olib tashlandi
                                        },
                                        body: JSON.stringify({ code: this.code })
                                    });

                                    console.log('Response status:', response.status);
                                    const data = await response.json();
                                    console.log('Response data:', data);

                                    if (data.success) {
                                            // Check if there's a redirect URL
                                            const redirectUrl = sessionStorage.getItem('redirect_after_login');
                                            if (redirectUrl) {
                                                sessionStorage.removeItem('redirect_after_login');
                                                window.location.href = redirectUrl;
                                            } else {
                                                window.location.href = data.redirect_url || '/';
                                            }
                                        }

                                    } else {
                                        this.errorMessage = data.error || 'Kirish muvaffaqiyatsiz';
                                    }
                                } catch (error) {
                                    console.error('Fetch error:', error);
                                    this.errorMessage = 'Tarmoq xatosi. Qayta urinib ko\'ring.';
                                } finally {
                                    this.isSubmitting = false;
                                }
                            }
                        }">

                            <form @submit.prevent="submitCode()">
                                <!-- Code Input -->
                                <div class="mb-6">
                                    <label class="block text-sm font-medium text-gray-700 mb-3">
                                        Botdan olgan 5 xonali kodni kiriting:
                                    </label>
                                    <input type="text"
                                           x-model="code"
                                           @input="code = code.replace(/[^0-9]/g, '').slice(0, 5); errorMessage = ''"
                                           placeholder="12345"
                                           maxlength="5"
                                           class="code-input w-full px-4 py-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
                                           :class="errorMessage ? 'border-red-300 focus:border-red-500 focus:ring-red-200' : ''"
                                           autocomplete="off">

                                    <!-- Progress Indicator -->
                                    <div class="mt-2 flex space-x-1">
                                        <template x-for="i in 5">
                                            <div class="flex-1 h-2 rounded-full"
                                                 :class="code.length >= i ? 'bg-primary-500' : 'bg-gray-200'"></div>
                                        </template>
                                    </div>
                                </div>

                                <!-- Error Message -->
                                <div x-show="errorMessage"
                                     x-transition:enter="transition ease-out duration-200"
                                     x-transition:enter-start="opacity-0 scale-95"
                                     x-transition:enter-end="opacity-100 scale-100"
                                     class="mb-4 bg-red-50 border border-red-200 rounded-lg p-3">
                                    <div class="flex items-center">
                                        <svg class="w-5 h-5 text-red-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        <span class="text-red-700 text-sm" x-text="errorMessage"></span>
                                    </div>
                                </div>

                                <!-- Submit Button -->
                                <button type="submit"
                                        :disabled="code.length !== 5 || isSubmitting"
                                        class="w-full bg-primary-600 text-white py-4 px-6 rounded-xl hover:bg-primary-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-semibold text-lg flex items-center justify-center">
                                    <span x-show="!isSubmitting">Kirish</span>
                                    <span x-show="isSubmitting" class="flex items-center">
                                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                        Tekshirilmoqda...
                                    </span>
                                </button>
                            </form>
                        </div>

                        <!-- Help Links -->
                        <div class="mt-8 pt-6 border-t border-gray-100">
                            <div class="text-center space-y-3">
                                <p class="text-sm text-gray-500">Muammo bormi?</p>
                                <div class="flex justify-center space-x-4 text-sm">
                                    <a href="{% url 'telegram_auth:bot_instructions' %}"
                                       class="text-primary-600 hover:text-primary-800 font-medium">
                                        Batafsil yo'riqnoma
                                    </a>
                                    <span class="text-gray-300">‚Ä¢</span>
                                    <a href="https://t.me/avtokontinent_support"
                                       target="_blank"
                                       class="text-primary-600 hover:text-primary-800 font-medium">
                                        Yordam olish
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Security Notice -->
                    <div class="mt-6 bg-green-50 border border-green-200 rounded-xl p-4">
                        <div class="flex items-start space-x-3">
                            <svg class="w-6 h-6 text-green-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                            </svg>
                            <div>
                                <h4 class="font-medium text-green-900 text-sm">Xavfsizlik kafolati</h4>
                                <p class="text-green-700 text-xs mt-1">
                                    Sizning ma'lumotlaringiz 256-bit SSL shifrlash bilan himoyalangan.
                                    Telefon raqamingiz faqat avtorizatsiya uchun ishlatiladi.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Alternative Login -->
                    <div class="mt-6 text-center">
                        <p class="text-sm text-gray-500 mb-3">Boshqa usul bilan kirish:</p>
                        <div class="space-y-2">
                            <a href="mailto:support@avtokontinent.uz?subject=Login yordam"
                               class="inline-flex items-center text-gray-600 hover:text-gray-800 text-sm">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                </svg>
                                Email orqali yordam so'rash
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Floating Animation Elements -->
<div class="fixed top-20 right-10 w-6 h-6 bg-blue-200 rounded-full floating-animation opacity-60 hidden lg:block"></div>
<div class="fixed top-40 left-10 w-4 h-4 bg-indigo-200 rounded-full floating-animation opacity-40 hidden lg:block" style="animation-delay: 1s;"></div>
<div class="fixed bottom-40 right-20 w-5 h-5 bg-purple-200 rounded-full floating-animation opacity-50 hidden lg:block" style="animation-delay: 2s;"></div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-focus on code input when page loads
    const codeInput = document.querySelector('.code-input');
    if (codeInput) {
        setTimeout(() => codeInput.focus(), 500);
    }

    // Add sound effects (optional)
    function playSound(type) {
        // Simple beep sound using Web Audio API
        if (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') {
            const audioContext = new (AudioContext || webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            if (type === 'success') {
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(1000, audioContext.currentTime + 0.1);
            } else if (type === 'error') {
                oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime + 0.1);
            } else {
                oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
            }

            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.2);
        }
    }

    // Enhanced code input handling
    const inputs = document.querySelectorAll('.code-input');
    inputs.forEach(input => {
        input.addEventListener('input', function() {
            // Play subtle sound on input
            if (this.value.length > 0) {
                playSound('input');
            }
        });

        input.addEventListener('paste', function(e) {
            e.preventDefault();
            const paste = (e.clipboardData || window.clipboardData).getData('text');
            const numbers = paste.replace(/[^0-9]/g, '').slice(0, 5);
            this.value = numbers;
            this.dispatchEvent(new Event('input'));
        });
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Alt + T to open Telegram bot
        if (e.altKey && e.key === 't') {
            e.preventDefault();
            window.open('https://t.me/{{ bot_username }}', '_blank');
        }

        // Enter to submit when code is complete
        if (e.key === 'Enter' && codeInput && codeInput.value.length === 5) {
            const submitBtn = document.querySelector('button[type="submit"]');
            if (submitBtn && !submitBtn.disabled) {
                submitBtn.click();
            }
        }
    });

    // Add visual feedback for bot link clicks
    const botLinks = document.querySelectorAll('a[href*="t.me"]');
    botLinks.forEach(link => {
        link.addEventListener('click', function() {
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 150);

            // Show toast message
            window.avtokontinent?.showToast('Telegram bot ochilmoqda...', 'info');
        });
    });

    // Add progress animation
    let progressInterval;
    function showProgress() {
        const progressBars = document.querySelectorAll('.progress-bar');
        let progress = 0;

        progressInterval = setInterval(() => {
            progress += 2;
            progressBars.forEach(bar => {
                bar.style.width = `${Math.min(progress, 100)}%`;
            });

            if (progress >= 100) {
                clearInterval(progressInterval);
            }
        }, 50);
    }

    // Auto-check bot status (optional feature)
    let checkBotInterval;
    function startBotStatusCheck() {
        checkBotInterval = setInterval(async () => {
            try {
                // This would check if user has started the bot (optional backend feature)
                const response = await fetch('/auth/check-bot-status/');
                const data = await response.json();

                if (data.bot_started) {
                    clearInterval(checkBotInterval);
                    // Show next step indicator
                }
            } catch (error) {
                // Ignore errors in status check
            }
        }, 5000);
    }

    // Cleanup on page unload
    window.addEventListener('beforeunload', function() {
        if (progressInterval) clearInterval(progressInterval);
        if (checkBotInterval) clearInterval(checkBotInterval);
    });

    // Add animation on scroll
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    });

    document.querySelectorAll('.step-card').forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = 'all 0.6s ease';
        observer.observe(card);
    });
});

// Global functions for external use
window.telegramAuth = {
    openBot() {
        window.open('https://t.me/{{ bot_username }}', '_blank');
    },

    refreshPage() {
        window.location.reload();
    }
};

// Add schema markup for SEO
const schemaData = {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Telegram Login - Avtokontinent.uz",
    "description": "Telegram bot orqali Avtokontinent.uz saytiga xavfsiz kirish",
    "url": "{{ request.build_absolute_uri }}",
    "mainEntity": {
        "@type": "WebApplication",
        "name": "Avtokontinent Telegram Auth",
        "applicationCategory": "Authentication",
        "operatingSystem": "Web Browser"
    }
};

const script = document.createElement('script');
script.type = 'application/ld+json';
script.textContent = JSON.stringify(schemaData);
document.head.appendChild(script);
</script>
{% endblock %}